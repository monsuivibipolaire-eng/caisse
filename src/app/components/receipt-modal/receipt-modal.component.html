<ion-header class="ion-no-border">
  <ion-toolbar class="bg-gray-100">
    <ion-title class="font-bold text-slate-700">Ticket de caisse</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="close()" color="dark">
        <ion-icon name="close-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="bg-gray-100">
  <div class="flex flex-col items-center py-8 h-full">

    <ng-container *ngIf="config$ | async as config">
      <div id="print-section" class="bg-white p-6 w-[80mm] shadow-xl text-black font-mono text-sm relative">
        
        <div class="absolute -bottom-2 left-0 w-full h-4 bg-white" style="clip-path: polygon(0% 0%, 5% 100%, 10% 0%, 15% 100%, 20% 0%, 25% 100%, 30% 0%, 35% 100%, 40% 0%, 45% 100%, 50% 0%, 55% 100%, 60% 0%, 65% 100%, 70% 0%, 75% 100%, 80% 0%, 85% 100%, 90% 0%, 95% 100%, 100% 0%);"></div>

        <div class="text-center mb-6 border-b pb-4 border-dashed border-gray-300">
          <h1 class="font-bold text-xl uppercase tracking-wider">{{ config.name }}</h1>
          <p class="mt-1 text-gray-600">{{ config.address }}</p>
          <p class="text-xs mt-2 text-gray-400">{{ sale?.date?.seconds * 1000 | date:'dd/MM/yyyy HH:mm' }}</p>
        </div>

        <div class="mb-6 space-y-2">
          <div *ngFor="let item of sale?.items" class="flex justify-between">
            <span class="truncate w-2/3">{{ item.product.name }} <span class="text-xs text-gray-500">x{{ item.quantity }}</span></span>
            <span class="text-right w-1/3 font-bold">{{ (item.product.price * item.quantity) | currency:'EUR':'symbol':'1.2-2' }}</span>
          </div>
        </div>

        <div class="border-t-2 border-black pt-2 mb-4">
          <div class="flex justify-between font-bold text-xl">
            <span>TOTAL</span>
            <span>{{ sale?.total | currency:'EUR':'symbol':'1.2-2' }}</span>
          </div>
          <div class="flex justify-between text-xs mt-2 text-gray-500">
            <span>{{ sale?.itemCount }} articles</span>
            <span>{{ sale?.paymentMethod }}</span>
          </div>
        </div>

        <div class="text-center text-xs mt-8 text-gray-500">
          <p>{{ config.footerMessage }}</p>
          <div class="mt-4 flex justify-center opacity-80">
             <div class="h-10 w-4/5 bg-gray-800"></div>
          </div>
        </div>
      </div>

      <div class="mt-10 mb-10">
        <button 
          ngxPrint 
          printSectionId="print-section" 
          [useExistingCss]="true"
          class="bg-slate-800 text-white px-8 py-4 rounded-full font-bold flex items-center gap-3 shadow-xl active:scale-95 transition-transform hover:bg-slate-700">
          <ion-icon name="print-outline" class="text-2xl"></ion-icon>
          IMPRIMER
        </button>
      </div>
    
    </ng-container>

  </div>
</ion-content>
